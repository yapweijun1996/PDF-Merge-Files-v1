<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Merger</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: #fff;
      padding: 2rem 2.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
      min-width: 350px;
    }
    .file-list {
      width: 100%;
      margin-bottom: 1rem;
      list-style: none;
      padding: 0;
    }
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f1f3f6;
      border-radius: 5px;
      margin-bottom: 0.5rem;
      padding: 0.5rem 0.75rem;
      gap: 0.5rem;
    }
    .file-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .file-actions button {
      margin-left: 0.25rem;
      background: #e0e7ef;
      color: #333;
      border: none;
      border-radius: 3px;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 0.95rem;
      transition: background 0.2s;
    }
    .file-actions button:hover {
      background: #b6d4fe;
    }
    button#merge {
      padding: 0.5rem 1.5rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
    }
    button#merge:hover {
      background: #0056b3;
    }
    #status {
      color: #333;
      font-size: 0.95rem;
      min-height: 1.2em;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.4);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: #e0e7ef;
      border: none;
      border-radius: 3px;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
      font-size: 1rem;
    }
    .modal-close:hover {
      background: #b6d4fe;
    }
    #pdf-preview {
      height: 85vh;
      max-height: 95vh;
      width: auto;
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Merge PDF Files</h2>
    <input type="file" id="pdfs" multiple accept="application/pdf">
    <ul class="file-list" id="fileList"></ul>
    <button id="merge">Merge PDFs</button>
    <div id="status"></div>
  </div>
  <!-- Modal for PDF preview -->
  <div class="modal" id="previewModal">
    <div class="modal-content">
      <button class="modal-close" id="closeModal">&times;</button>
      <canvas id="pdf-preview"></canvas>
    </div>
  </div>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@latest/build/pdf.min.js"></script>
  <script>
    const input = document.getElementById('pdfs');
    const mergeBtn = document.getElementById('merge');
    const statusDiv = document.getElementById('status');
    const fileList = document.getElementById('fileList');
    const previewModal = document.getElementById('previewModal');
    const closeModal = document.getElementById('closeModal');
    const pdfPreview = document.getElementById('pdf-preview');

    let filesArr = [];

    function renderFileList() {
      fileList.innerHTML = '';
      filesArr.forEach((file, idx) => {
        const li = document.createElement('li');
        li.className = 'file-item';
        const nameDiv = document.createElement('div');
        nameDiv.className = 'file-name';
        nameDiv.textContent = file.name;
        const actions = document.createElement('div');
        actions.className = 'file-actions';
        // Up button
        const upBtn = document.createElement('button');
        upBtn.textContent = '↑';
        upBtn.title = 'Move up';
        upBtn.disabled = idx === 0;
        upBtn.onclick = () => {
          if (idx > 0) {
            [filesArr[idx-1], filesArr[idx]] = [filesArr[idx], filesArr[idx-1]];
            renderFileList();
          }
        };
        // Down button
        const downBtn = document.createElement('button');
        downBtn.textContent = '↓';
        downBtn.title = 'Move down';
        downBtn.disabled = idx === filesArr.length - 1;
        downBtn.onclick = () => {
          if (idx < filesArr.length - 1) {
            [filesArr[idx+1], filesArr[idx]] = [filesArr[idx], filesArr[idx+1]];
            renderFileList();
          }
        };
        // Preview button
        const previewBtn = document.createElement('button');
        previewBtn.textContent = 'Preview';
        previewBtn.onclick = () => previewPDF(file);
        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '✕';
        removeBtn.title = 'Remove';
        removeBtn.onclick = () => {
          filesArr.splice(idx, 1);
          renderFileList();
        };
        actions.appendChild(upBtn);
        actions.appendChild(downBtn);
        actions.appendChild(previewBtn);
        actions.appendChild(removeBtn);
        li.appendChild(nameDiv);
        li.appendChild(actions);
        fileList.appendChild(li);
      });
    }

    input.onchange = (e) => {
      filesArr = Array.from(e.target.files);
      renderFileList();
    };

    // PDF.js preview logic
    async function previewPDF(file) {
      // Debug: Log pdfjsLib and file info
      console.log('window.pdfjsLib:', window.pdfjsLib);
      console.log('Previewing file:', file.name, 'size:', file.size);
      const fileReader = new FileReader();
      fileReader.onload = async function() {
        try {
          if (!window.pdfjsLib) {
            alert('PDF.js library not loaded!');
            return;
          }
          const typedarray = new Uint8Array(this.result);
          const loadingTask = window['pdfjsLib'].getDocument({data: typedarray});
          const pdf = await loadingTask.promise;
          const page = await pdf.getPage(1);
          const viewport = page.getViewport({scale: 1.5});
          const canvas = pdfPreview;
          const context = canvas.getContext('2d');
          canvas.width = viewport.width;
          canvas.height = viewport.height;
          await page.render({canvasContext: context, viewport: viewport}).promise;
          previewModal.style.display = 'flex';
        } catch (err) {
          console.error('PDF preview error:', err);
          pdfPreview.width = 400;
          pdfPreview.height = 100;
          const ctx = pdfPreview.getContext('2d');
          ctx.clearRect(0, 0, pdfPreview.width, pdfPreview.height);
          ctx.font = '16px Arial';
          ctx.fillStyle = 'red';
          ctx.fillText('Error loading PDF preview', 10, 50);
          previewModal.style.display = 'flex';
        }
      };
      fileReader.readAsArrayBuffer(file);
    }

    closeModal.onclick = () => {
      previewModal.style.display = 'none';
      pdfPreview.getContext('2d').clearRect(0, 0, pdfPreview.width, pdfPreview.height);
    };
    // Close modal on outside click
    previewModal.onclick = (e) => {
      if (e.target === previewModal) {
        closeModal.onclick();
      }
    };

    mergeBtn.onclick = async () => {
      if (!filesArr.length) {
        statusDiv.textContent = 'Please select PDF files.';
        return;
      }
      statusDiv.textContent = 'Merging...';
      try {
        const { PDFDocument } = window.PDFLib;
        const mergedPdf = await PDFDocument.create();
        for (let file of filesArr) {
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await PDFDocument.load(arrayBuffer);
          const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
          copiedPages.forEach(page => mergedPdf.addPage(page));
        }
        const mergedPdfBytes = await mergedPdf.save();
        const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'merged.pdf';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        statusDiv.textContent = 'Merged PDF downloaded!';
      } catch (err) {
        statusDiv.textContent = 'Error merging PDFs: ' + err.message;
      }
    };
  </script>
</body>
</html> 